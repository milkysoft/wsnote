(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;$.Define($$,{WsNote:{BlogUI:{main:function(){var P,Q,T;T=function(U){return U?i["doc'settings"]():e.get_Empty();};Q=c.Div0(d.ofArray([e.EmbedView(f.Map(function(R){return c.Nav0(d.ofArray([i["doc'nav"](R[1])]));},i["v'blog"]())),j.txt("Search"),(j.input0())(i["var'context"]()),e.EmbedView(f.Map(function(){i["var'page'number"]().set_Value("0");return e.get_Empty();},i["var'context"]().get_View())),j["Doc'Map"](i["var'is'settings'visible"]().get_View(),T)]));P=c.Div0(d.ofArray([((k.on())(e.get_Empty()))(Q),e.EmbedView(f.Map(function(V){var W,X;W=V[0];X=e.ConvertBy(function(Y){return Y.Id;},function(Z){return l.doc(W,Z);},m.View(W.Posts));return((k.on())(k.doc(W)))(c.UL0(d.ofArray([X])));},i["v'blog"]()))]));return((n["on'visible"]())(n["doc'logining"]()))(P);},"web application client side core":{"b'nav":function(_0){var _1,_2,_3,_4,_5,bd;_1=(_0.TotlalLen/_0.PageLen>>0)-(_0.TotlalLen%_0.PageLen===0?1:0);_2=o.Max(_0.PageNum-4,0);_3=o.Min(_2+8,_1);_4=o.Max(_3-8,0);_5=function(_6){var _7,_8,_9,ba;_7=_6===_0.PageNum;_8=_6===0?"Beginning":_6===_1?"End "+$$.String(_6+1):"Page "+$$.String(_6+1);_9=p.toList(p.delay(function(){return _7?[q.Class("current-page-button")]:p.empty();}));ba=function(){var bc;bc=r(_6);return i["var'page'number"]().get_Value()!==bc?i["var'page'number"]().set_Value(r(_6)):null;};return c.LI0(d.ofArray([e.Button(_8,_9,ba)]));};bd=p.toList(p.delay(function(){return p.map(function(bf){return(bf===_4?_4!==0:false)?0:(bf===_3?_3!==_1:false)?_1:bf;},o.range(_4,_3));}));return d.map(_5,bd);},"doc'nav":function(bf){return c.UL0(p.toList(p.delay(function(){return p.append([c.LI0(d.ofArray([n.button()]))],p.delay(function(){return p.append([c.LI0(d.ofArray([((n["is'logged'in"]())(k.button()))(e.get_Empty())]))],p.delay(function(){return p.append(i["b'nav"](bf),p.delay(function(){return[c.LI0(d.ofArray([(j.button0("Settings"))(function(){return i["var'is'settings'visible"]().set_Value(true);})]))];}));}));}));})));},"doc'settings":$.Field(function(){var bl,bn,bo;bl=function(bm){return i.hide(bm);};bn=$.New(s,{$:0});bo=function(bp){return i.hide(bp);};return c.Div(d.ofArray([q.Class("b-popup")]),d.ofArray([c.Div(d.ofArray([q.Class("b-popup-content"),q.Handler("blur",bl)]),d.ofArray([c.Table0(d.ofArray([c.TR0(d.ofArray([c.TD0(d.ofArray([j.txt("Stories count on one page")])),c.TD0(d.ofArray([(j.input0())(i["var'posts'count"]())]))])),c.TR0(d.ofArray([c.TD(d.ofArray([q.Create("colspan","2"),q.Style("text-align","right")]),d.ofArray([e.Button("Close",bn,bo)]))]))]))]))]));}),hide:function(){return i["var'is'settings'visible"]().set_Value(false);},"v'blog":$.Field(function(){var br,bs,bw;br=f.get_Do();bs=br.Bind(j.op_LessMultiplyGreater(j["var'str'to'int"](0).get_View(),i["var'page'number"]().get_View()),function(bt){return br.Bind(j.op_LessMultiplyGreater(j["var'str'to'int"](10).get_View(),i["var'posts'count"]().get_View()),function(bu){return br.Bind(i["var'context"]().get_View(),function(bv){return br.Return([bt,bu,bv]);});});});bw=function(bx){var by,bz,bA;by=bx[0];bz=bx[1];bA=bx[2];return t.Delay(function(){return t.Bind(u["read'page"](by,bz,bA),function(bC){return t.Return([bC,{PageNum:by,PageLen:bz,TotlalLen:bC.TotalCount.get_Value()}]);});});};return f.MapAsync(bw,bs);}),"var'context":$.Field(function(){return v.Create("");}),"var'is'settings'visible":$.Field(function(){return v.Create(false);}),"var'page'number":$.Field(function(){return v.Create("0");}),"var'posts'count":$.Field(function(){return v.Create("10");})}},ClientBlogData:{"add'post":function(bD,bE,bF){var bG,bH,bI,bJ,bK,bL;bG=[bD,bE,bF];bH=bG[0];bI=bG[1];bJ=bG[2];bK={$:3,$0:bH,$1:bI,$2:bJ};bL=w.crud();bL.mailbox.AddLast(bK);return bL.resume();},"delete'post":function(bM,bN){var bO,bP,bQ,bR,bS;bO=[bM,bN.Id];bP=bO[0];bQ=bO[1];bR={$:2,$0:bP,$1:bQ};bS=w.crud();bS.mailbox.AddLast(bR);return bS.resume();},"read'page":function(bT,bU,bV){return w.crud().PostAndAsyncReply(function(bW){return{$:0,$0:bT,$1:bU,$2:bV,$3:bW};},{$:0});},"update'post":function(bX){var bY,bZ;bY={$:1,$0:bX};bZ=w.crud();bZ.mailbox.AddLast(bY);return bZ.resume();},"\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438 \u043d\u0430 \u0430\u0441\u043d\u043e\u0432\u0435 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439":{"create'post":function(b0){return{Id:b0.Id,Title:v.Create(b0.Title),Content:v.Create(b0.Content),CreateDate:b0.CreateDate,EditDate:v.Create(b0.EditDate),Num:v.Create(b0.Num),EditedTitle:v.Create(b0.Title),EditedContent:v.Create(b0.Content),IsEditMode:v.Create(false)};},crud:$.Field(function(){return y.Start(function(b1){var b2;b2=function(){return t.Delay(function(){var b5;b5=b1.Receive({$:0});return t.Bind(b5,function(b6){var b7,b8,b_,b$,ca,cb,cc,cd,ci,cj,ck,cl,cm;if(b6.$==1){b8=b6.$0;b8.IsEditMode.set_Value(false);b7=t.Bind(A.Async("WsNote2:2",[b8.Id,b8.EditedTitle.get_Value(),b8.EditedContent.get_Value()]),function(b9){b8.Content.set_Value(b9.Content);b8.Title.set_Value(b9.Title);b8.EditDate.set_Value(b9.EditDate);return t.Return(null);});}else{if(b6.$==2){b_=b6.$1;b$=b6.$0;A.Send("WsNote2:1",[b_]);b$.Posts.RemoveByKey(b_);b$.TotalCount.set_Value(b$.TotalCount.get_Value()-1);b7=t.Return(null);}else{if(b6.$==3){ca=b6.$1;cb=b6.$2;cc=b6.$0;cd=A.Async("WsNote2:0",[ca,cb]);b7=t.Bind(cd,function(ce){var cf,cg;cf=D.New2();cg=w["create'post"](ce);cf.Add(cg);cc.Posts.Iter(function(ch){return cf.Add(ch);});cc.Posts.Clear();cc.Posts.Set(cf);return t.Return(null);});}else{ci=b6.$3;cj=b6.$1;ck=b6.$0;cl=b6.$2;cm=A.Async("WsNote2:3",[ck,cj,cl]);b7=t.Bind(cm,function(cn){var co,cp,cq,cr,ct;co=cn[0];cp=cn[1];cr=function(cs){return cs.Id;};ct=d.map(function(cu){return w["create'post"](cu);},cp);cq={Posts:E.Create(cr,ct),TotalCount:v.Create(co)};ci(cq);return t.Return(null);});}}}return t.Combine(b7,t.Delay(function(){return b2(null);}));});});};return b2(null);},{$:0});}),"update'post":function(cw,cx){cw.Title.set_Value(cx.Title);cw.Content.set_Value(cx.Content);cw.EditDate.set_Value(cx.EditDate);return cw.Num.set_Value(cx.Num);}}},ClientUtils:{isNumber:function($n){var $0=this,$this=this;return!$$.isNaN($$.parseFloat($n))&&$$.isFinite($n);},"strToInt'or'zero":function($x){var $0=this,$this=this;return $$.Math.abs(~(~$x));},"|Str'Int|_|":function(cy){var cz,cA;if(r(~(~F(cy)))===cy){cA=G["strToInt'or'zero"](cy);cz={$:1,$0:cA};}else{cz={$:0};}return cz;}},LoginUI:{button:$.Field(function(){return((n["is'logged'in"]())(H["button'logout"]()))(H["button'login"]());}),"doc'logining":$.Field(function(){var cB,cC,cD,cE,cM,cN;cB=$.New(s,{$:0});cC=H["var'pass"]();cD=H["var'is'loginign'process"]().get_View();cE=function(cF){return cF?j.txt("Logining to website..."):(j.button0("Login"))(function(){return H.login();});};cM=H["var'error"]().get_View();cN=function(cO){var cP,cQ;if(cO.$==1){cQ=cO.$0;cP=c.Div(d.ofArray([q.Style("color","red")]),d.ofArray([c.H20(d.ofArray([j.txt(cQ)]))]));}else{cP=e.get_Empty();}return cP;};return c.Div0(d.ofArray([c.H10(d.ofArray([j.txt("Sign in")])),c.Table0(d.ofArray([c.TR0(d.ofArray([c.TD0(d.ofArray([j.txt("User name")])),c.TD0(d.ofArray([(j.input0())(H["var'user"]())]))])),c.TR0(d.ofArray([c.TD0(d.ofArray([j.txt("Password")])),c.TD0(d.ofArray([e.PasswordBox(cB,cC)]))]))])),c.P0(d.ofArray([j["Doc'Map"](cD,cE),(j.button0("Cancel"))(function(){var cI,cJ,cK,cL;H["var'is'visible"]().set_Value(false);H["var'error"]().set_Value({$:0});cI=H.op_SpliceUntyped(H["key'user"]());cJ=H["var'user"]();v.Set(cJ,cI);cK=H.op_SpliceUntyped(H["key'pass"]());cL=H["var'pass"]();return v.Set(cL,cK);})])),j["Doc'Map"](cM,cN)]));}),"is'logged'in":$.Field(function(){return function(cR){return function(cS){return j["doc'on'off"](H["var'is'logged'in"](),cR,cS);};};}),"on'visible":$.Field(function(){return function(cT){return function(cU){return j["doc'on'off"](H["var'is'visible"](),cT,cU);};};}),"private members":{"button'login":$.Field(function(){return(j.button0("Login"))(function(){return H["go'to'logining"]();});}),"button'logout":$.Field(function(){return(j.button0("Logout"))(function(){var cX;cX=t.Delay(function(){return t.Bind(A.Async("WsNote2:7",[]),function(){H["var'is'logged'in"]().set_Value(false);return t.Return(null);});});return t.Start(cX,{$:0});});}),"go'to'logining":function(){return H["var'is'visible"]().set_Value(true);},key:$.Field(function(){return"4B929568-625C-4CD0-BED4-8EACC78D21E6-blog-";}),"key'pass":$.Field(function(){return H.key()+"pass";}),"key'user":$.Field(function(){return H.key()+"user";}),localStorage:function(){return I.localStorage;},login:function(){var c0;c0=t.Delay(function(){var c2;H["var'is'loginign'process"]().set_Value(true);c2=A.Async("WsNote2:6",[H["var'user"]().get_Value(),H["var'pass"]().get_Value()]);return t.Bind(c2,function(c3){var c4;H["var'is'loginign'process"]().set_Value(false);if(c3){H["var'is'visible"]().set_Value(false);H.op_LessEqualsEquals(H["key'user"](),H["var'user"]().get_Value());H.op_LessEqualsEquals(H["key'pass"](),H["var'pass"]().get_Value());H["var'is'logged'in"]().set_Value(true);H["var'error"]().set_Value({$:0});c4=t.Return(null);}else{H["var'error"]().set_Value({$:1,$0:"Username or password incorrect"});c4=t.Return(null);}return c4;});});return t.Start(c0,{$:0});},op_LessEqualsEquals:function(c5,c6){var c7,c8,c9,da,db;try{c7=H.localStorage().setItem(c5,c6);}catch(c8){c9=function(c_){var c$;c$="localStorage : "+J.prettyPrint(c_);return K?K.log(c$):undefined;};da=H.localStorage();c9(da);db=function(dc){var dd;dd="localStorage.SetItem : "+J.prettyPrint(dc);return K?K.log(dd):undefined;};c7=db(c8);}return c7;},op_SpliceUntyped:function(de){var df,dg,dh,dk,dl;try{df=H.localStorage().getItem(de);}catch(dg){dh=function(di){var dj;dj="localStorage : "+J.prettyPrint(di);return K?K.log(dj):undefined;};dk=H.localStorage();dh(dk);dl=function(dm){var dn;dn="localStorage.GetItem : "+J.prettyPrint(dm);return K?K.log(dn):undefined;};dl(dg);df="";}return df;},"var'error":$.Field(function(){return v.Create({$:0});}),"var'is'logged'in":$.Field(function(){return v.Create(false);}),"var'is'loginign'process":$.Field(function(){return v.Create(false);}),"var'is'visible":$.Field(function(){return v.Create(false);}),"var'pass":$.Field(function(){var _do;_do=H.op_SpliceUntyped(H["key'pass"]());return v.Create(_do);}),"var'user":$.Field(function(){var dp;dp=H.op_SpliceUntyped(H["key'user"]());return v.Create(dp);})},protect:function(dq){return((n["is'logged'in"]())(dq))(e.get_Empty());},"set'logged'in":$.Field(function(){var dr;dr=H["var'is'logged'in"]();return function(ds){return v.Set(dr,ds);};})},NewPostUI:{button:$.Field(function(){return(j.button0("Create story"))(function(){return L["var'is'creating"]().set_Value(true);});}),doc:function(du){var dv,dw;dv=d.ofArray([q.Style("width","100%")]);dw=L["var'title"]();return c.Div0(d.ofArray([c.H10(d.ofArray([j.txt("New Story")])),c.P0(d.ofArray([j.txt("Story title"),e.Input(dv,dw)])),c.P0(d.ofArray([j.txt("Story content"),j["doc'edit'content'input'area"](L["var'content"]())])),c.P0(d.ofArray([(j.button0("Create"))(function(){u["add'post"](du,L["var'title"]().get_Value(),L["var'content"]().get_Value());return L.reset();}),(j.button0("Cancel"))(function(){return L.reset();})]))]));},on:$.Field(function(){return function(dz){return function(dA){return j["doc'on'off"](L["var'is'creating"](),dz,dA);};};}),"private members":{reset:function(){L["var'title"]().set_Value("");L["var'content"]().set_Value("");return L["var'is'creating"]().set_Value(false);},"var'content":$.Field(function(){return v.Create("");}),"var'is'creating":$.Field(function(){return v.Create(false);}),"var'title":$.Field(function(){return v.Create("");})}},PostUI:{doc:function(dB,dC){var dD,dE,dF;dD="post-"+$$.String(dC.Id)+"-article";dE=d.ofArray([q.Style("width","100%")]);dF=dC.EditedTitle;return c.LI(d.ofArray([q.Create("id",dD)]),d.ofArray([M["doc'header"](dB,dC),M["on'edit"](dC,c.Div0(d.ofArray([c.P0(d.ofArray([j.txt("Title"),e.Input(dE,dF)])),c.P0(d.ofArray([j.txt("Content"),j["doc'edit'content'input'area"](dC.EditedContent)]))])),M["doc'static'content"](dC))]));},"private members":{"doc'crud":function(dG,dH){var dK;dK=c.Span0(d.ofArray([(j.button0("Delete"))(function(){return u["delete'post"](dG,dH);}),(j.button0("Change"))(function(){return dH.IsEditMode.set_Value(true);})]));return M["on'edit"](dH,c.Span0(d.ofArray([(j.button0("Apply"))(function(){return u["update'post"](dH);}),(j.button0("Cancel"))(function(){return dH.IsEditMode.set_Value(false);})])),n.protect(dK));},"doc'date":function(dN){return c.Div(d.ofArray([q.Class("post-date-block")]),d.ofArray([j.txt("Created:"),j.txt(dN.CreateDate),j.txt("Changed:"),e.TextView(dN.EditDate.get_View())]));},"doc'header":function(dO,dP){var dQ,dR;dQ=dP.Num.get_View();dR=function(dS){return j.txt($$.String(dS));};return c.Div(d.ofArray([q.Class("post-header-block")]),d.ofArray([c.Div(d.ofArray([q.Class("post-title-text-block")]),d.ofArray([e.TextView(dP.Title.get_View())])),M["doc'crud"](dO,dP),j.txt("Num "),j["Doc'Map"](dQ,dR),M["doc'date"](dP)]));},"doc'static'content":function(dT){var dU,dV;dU=dT.Content.get_View();dV=function(dW){var dX,dY,dZ;dX=N("<div class=\"post-content-block\">"+dW+"</div>").get(0);try{dY=e.Static(dX);}catch(dZ){dY=j.txt(dW);}return dY;};return c.Div0(d.ofArray([j["Doc'Map"](dU,dV)]));},"on'edit":function(d0,d1,d2){var d3,d4;d3=d0.IsEditMode.get_View();d4=function(d5){return d5?d1:d2;};return j["Doc'Map"](d3,d4);}}},UINextUtils:{"Doc'Map":function(d6,d7){var d8;d8=f.Map(d7,d6);return e.EmbedView(d8);},addViewListener:function(d9,d_,d$){var ea,ec,ed;ea=function(eb){d_(eb);return e.get_Empty();};ec=f.Map(ea,d9);ed=e.EmbedView(ec);return e.Append(d$,ed);},button0:function(ee){var ef;ef=$.New(s,{$:0});return function(eg){return e.Button(ee,ef,eg);};},"doc'edit'content'input'area":function(eh){var ei;ei=d.ofArray([q.Class("edit-post-input-area")]);return e.InputArea(ei,eh);},"doc'on'off":function(ej,ek,el){var em,en;em=f.FromVar(ej);en=function(eo){return eo?ek:el;};return j["Doc'Map"](em,en);},input0:$.Field(function(){var ep;ep=$.New(s,{$:0});return function(eq){return e.Input(ep,eq);};}),op_LessMultiplyGreater:function(er,es){return O.Apply(er,es);},txt:function(et){return e.TextNode(et);},"var'str'to'int":function(eu){var ev;ev=function(ew){var ex,ey,ez;ex=G["|Str'Int|_|"](ew);if(ex.$==1){ez=ex.$0;ey=ez;}else{ey=eu;}return ey;};return v.Create(ev);}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.Html);d=$.Safe($$.WebSharper.List);e=$.Safe(b.Doc);f=$.Safe(b.View);g=$.Safe($$.WsNote);h=$.Safe(g.BlogUI);i=$.Safe(h["web application client side core"]);j=$.Safe(g.UINextUtils);k=$.Safe(g.NewPostUI);l=$.Safe(g.PostUI);m=$.Safe(b.ListModel1);n=$.Safe(g.LoginUI);o=$.Safe($$.WebSharper.Operators);p=$.Safe($$.WebSharper.Seq);q=$.Safe(b.Attr);r=$.Safe($$.String);s=$.Safe(d.T);t=$.Safe($$.WebSharper.Concurrency);u=$.Safe(g.ClientBlogData);v=$.Safe(b.Var);w=$.Safe(u["\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438 \u043d\u0430 \u0430\u0441\u043d\u043e\u0432\u0435 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439"]);x=$.Safe($$.WebSharper.Control);y=$.Safe(x.MailboxProcessor);z=$.Safe($$.WebSharper.Remoting);A=$.Safe(z.AjaxRemotingProvider);B=$.Safe($$.WebSharper.Collections);C=$.Safe(B.ResizeArray);D=$.Safe(C.ResizeArrayProxy);E=$.Safe(b.ListModel);F=$.Safe($$.Number);G=$.Safe(g.ClientUtils);H=$.Safe(n["private members"]);I=$.Safe($$.window);J=$.Safe($$.WebSharper.PrintfHelpers);K=$.Safe($$.console);L=$.Safe(k["private members"]);M=$.Safe(l["private members"]);N=$.Safe($$.jQuery);return O=$.Safe(b.View1);});$.OnLoad(function(){j.input0();L["var'title"]();L["var'is'creating"]();L["var'content"]();k.on();k.button();n["set'logged'in"]();H["var'user"]();H["var'pass"]();H["var'is'visible"]();H["var'is'loginign'process"]();H["var'is'logged'in"]();H["var'error"]();H["key'user"]();H["key'pass"]();H.key();H["button'logout"]();H["button'login"]();n["on'visible"]();n["is'logged'in"]();n["doc'logining"]();n.button();w.crud();i["var'posts'count"]();i["var'page'number"]();i["var'is'settings'visible"]();i["var'context"]();i["v'blog"]();i["doc'settings"]();return;});}());
