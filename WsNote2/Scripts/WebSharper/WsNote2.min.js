(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;$.Define($$,{WsNote:{BlogUI:{main:function(){var P,Q,R,S,T,X;P=c.Create("placeholder","Search");Q=c.Class("mainsearch");R=d.append([P],e.ofArray([Q]));g.login();X=function(Y){return Y?l["doc'settings"]():i.get_Empty();};T=h.Div(e.ofArray([c.Class("navbar navbar-default navbar-fixed-top")]),e.ofArray([h.Div(e.ofArray([c.Class("navbar-header")]),e.ofArray([i.EmbedView(j.Map(function(U){return h.Nav0(e.ofArray([l["doc'nav'left"](U[1])]));},l["v'blog"]()))])),h.Div(e.ofArray([c.Class("navbar-collapse collapse")]),e.ofArray([h.Div(e.ofArray([c.Class("navbar-collapse collapse")]),e.ofArray([h.Div(e.ofArray([c.Class("pull-right")]),e.ofArray([h.Div(e.ofArray([c.Class("nav")]),e.ofArray([h.UL(e.ofArray([c.Class("nav navbar-nav sm sm-collapsible")]),e.ofArray([h.LI0(e.ofArray([i.Input(R,l["var'context"]())]))])),i.EmbedView(j.Map(function(){l["var'page'number"]().set_Value("0");return i.get_Empty();},l["var'context"]().get_View())),i.EmbedView(j.Map(function(W){return l["doc'nav'right"](W[1]);},l["v'blog"]())),m["Doc'Map"](l["var'is'settings'visible"]().get_View(),X)]))]))]))]))]));S=h.Div(e.ofArray([c.Class("container")]),e.ofArray([((n.on())(i.get_Empty()))(T),i.EmbedView(j.Map(function(Z){var _0,_1;_0=Z[0];_1=i.ConvertBy(function(_2){return _2.Id;},function(_3){return o.doc(_0,_3);},p.View(_0.Posts));return((n.on())(n.doc(_0)))(h.UL(e.ofArray([c.Class("ul-top-blog")]),e.ofArray([_1])));},l["v'blog"]()))]));return((g["on'visible"]())(g["doc'logining"]()))(S);},"web application client side core":{"b'nav":function(_4){var _5,_6,_7,_8,_9,bh;_5=(_4.TotlalLen/_4.PageLen>>0)-(_4.TotlalLen%_4.PageLen===0?1:0);_6=q.Max(_4.PageNum-4,0);_7=q.Min(_6+8,_5);_8=q.Max(_7-8,0);_9=function(_){var ba,bb,bc,be;ba=_===_4.PageNum;bb=_===0?"Page "+$$.String(_+1):_===_5?"End "+$$.String(_+1):"Page "+$$.String(_+1);bc=d.toList(d.delay(function(){return ba?[c.Class("current-page-button")]:d.empty();}));be=function(){var bg;bg=r(_);return l["var'page'number"]().get_Value()!==bg?l["var'page'number"]().set_Value(r(_)):null;};return h.LI0(e.ofArray([i.Button(bb,bc,be)]));};bh=d.toList(d.delay(function(){return d.map(function(bj){return(bj===_8?_8!==0:false)?0:(bj===_7?_7!==_5:false)?_5:bj;},q.range(_8,_7));}));return e.map(_9,bh);},"doc'nav'left":function(){return h.Div(e.ofArray([c.Class("navbar-collapse collapse")]),e.ofArray([h.UL(e.ofArray([c.Class("nav navbar-nav sm")]),d.toList(d.delay(function(){return[h.LI0(e.ofArray([((g["is'logged'in"]())(n.button()))(i.get_Empty())]))];})))]));},"doc'nav'right":function(){return h.UL(e.ofArray([c.Class("nav navbar-nav sm sm-collapsible")]),d.toList(d.delay(function(){var bn,bo;bn=e.ofArray([c.Class("mainsettingsbtn")]);bo=function(){return l["var'is'settings'visible"]().set_Value(true);};return d.append([h.LI0(e.ofArray([i.Button("Settings",bn,bo)]))],d.delay(function(){return[h.LI0(e.ofArray([g.button()]))];}));})));},"doc'settings":$.Field(function(){var br,bt,bu;br=function(bs){return l.hide(bs);};bt=$.New(s,{$:0});bu=function(bv){return l.hide(bv);};return h.Div(e.ofArray([c.Class("b-popup")]),e.ofArray([h.Div(e.ofArray([c.Class("b-popup-content"),c.Handler("blur",br)]),e.ofArray([h.Table0(e.ofArray([h.TR0(e.ofArray([h.TD0(e.ofArray([m.txt("Stories count on one page")])),h.TD0(e.ofArray([(m.input0())(l["var'posts'count"]())]))])),h.TR0(e.ofArray([h.TD(e.ofArray([c.Create("colspan","2"),c.Style("text-align","right")]),e.ofArray([i.Button("Close",bt,bu)]))]))]))]))]));}),hide:function(){return l["var'is'settings'visible"]().set_Value(false);},"v'blog":$.Field(function(){var bx,by,bC;bx=j.get_Do();by=bx.Bind(m.op_LessMultiplyGreater(m["var'str'to'int"](0).get_View(),l["var'page'number"]().get_View()),function(bz){return bx.Bind(m.op_LessMultiplyGreater(m["var'str'to'int"](10).get_View(),l["var'posts'count"]().get_View()),function(bA){return bx.Bind(l["var'context"]().get_View(),function(bB){return bx.Return([bz,bA,bB]);});});});bC=function(bD){var bE,bF,bG;bE=bD[0];bF=bD[1];bG=bD[2];return t.Delay(function(){return t.Bind(u["read'page"](bE,bF,bG),function(bI){return t.Return([bI,{PageNum:bE,PageLen:bF,TotlalLen:bI.TotalCount.get_Value()}]);});});};return j.MapAsync(bC,by);}),"var'context":$.Field(function(){return v.Create("");}),"var'is'settings'visible":$.Field(function(){return v.Create(false);}),"var'page'number":$.Field(function(){return v.Create("0");}),"var'posts'count":$.Field(function(){return v.Create("10");})}},ClientBlogData:{"add'post":function(bJ,bK,bL){var bM,bN,bO,bP,bQ,bR;bM=[bJ,bK,bL];bN=bM[0];bO=bM[1];bP=bM[2];bQ={$:3,$0:bN,$1:bO,$2:bP};bR=w.crud();bR.mailbox.AddLast(bQ);return bR.resume();},"delete'post":function(bS,bT){var bU,bV,bW,bX,bY;bU=[bS,bT.Id];bV=bU[0];bW=bU[1];bX={$:2,$0:bV,$1:bW};bY=w.crud();bY.mailbox.AddLast(bX);return bY.resume();},"read'page":function(bZ,b0,b1){return w.crud().PostAndAsyncReply(function(b2){return{$:0,$0:bZ,$1:b0,$2:b1,$3:b2};},{$:0});},"update'post":function(b3){var b4,b5;b4={$:1,$0:b3};b5=w.crud();b5.mailbox.AddLast(b4);return b5.resume();},"\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438 \u043d\u0430 \u0430\u0441\u043d\u043e\u0432\u0435 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439":{"create'post":function(b6){return{Id:b6.Id,Title:v.Create(b6.Title),Content:v.Create(b6.Content),CreateDate:b6.CreateDate,EditDate:v.Create(b6.EditDate),Num:v.Create(b6.Num),EditedTitle:v.Create(b6.Title),EditedContent:v.Create(b6.Content),IsEditMode:v.Create(false)};},crud:$.Field(function(){return y.Start(function(b7){var b8;b8=function(){return t.Delay(function(){var b$;b$=b7.Receive({$:0});return t.Bind(b$,function(ca){var cb,cc,ce,cf,cg,ch,ci,cj,co,cp,cq,cr,cs;if(ca.$==1){cc=ca.$0;cc.IsEditMode.set_Value(false);cb=t.Bind(A.Async("WsNote2:2",[cc.Id,cc.EditedTitle.get_Value(),cc.EditedContent.get_Value()]),function(cd){cc.Content.set_Value(cd.Content);cc.Title.set_Value(cd.Title);cc.EditDate.set_Value(cd.EditDate);return t.Return(null);});}else{if(ca.$==2){ce=ca.$1;cf=ca.$0;A.Send("WsNote2:1",[ce]);cf.Posts.RemoveByKey(ce);cf.TotalCount.set_Value(cf.TotalCount.get_Value()-1);cb=t.Return(null);}else{if(ca.$==3){cg=ca.$1;ch=ca.$2;ci=ca.$0;cj=A.Async("WsNote2:0",[cg,ch]);cb=t.Bind(cj,function(ck){var cl,cm;cl=D.New2();cm=w["create'post"](ck);cl.Add(cm);ci.Posts.Iter(function(cn){return cl.Add(cn);});ci.Posts.Clear();ci.Posts.Set(cl);return t.Return(null);});}else{co=ca.$3;cp=ca.$1;cq=ca.$0;cr=ca.$2;cs=A.Async("WsNote2:3",[cq,cp,cr]);cb=t.Bind(cs,function(ct){var cu,cv,cw,cx,cz;cu=ct[0];cv=ct[1];cx=function(cy){return cy.Id;};cz=e.map(function(cA){return w["create'post"](cA);},cv);cw={Posts:E.Create(cx,cz),TotalCount:v.Create(cu)};co(cw);return t.Return(null);});}}}return t.Combine(cb,t.Delay(function(){return b8(null);}));});});};return b8(null);},{$:0});}),"update'post":function(cC,cD){cC.Title.set_Value(cD.Title);cC.Content.set_Value(cD.Content);cC.EditDate.set_Value(cD.EditDate);return cC.Num.set_Value(cD.Num);}}},ClientUtils:{isNumber:function($n){var $0=this,$this=this;return!$$.isNaN($$.parseFloat($n))&&$$.isFinite($n);},"strToInt'or'zero":function($x){var $0=this,$this=this;return $$.Math.abs(~(~$x));},"|Str'Int|_|":function(cE){var cF,cG;if(r(~(~F(cE)))===cE){cG=G["strToInt'or'zero"](cE);cF={$:1,$0:cG};}else{cF={$:0};}return cF;}},LoginUI:{button:$.Field(function(){return((g["is'logged'in"]())(H["button'logout"]()))(H["button'login"]());}),"doc'logining":$.Field(function(){var cH,cI,cJ,cK,cS,cT;cH=$.New(s,{$:0});cI=H["var'pass"]();cJ=H["var'is'loginign'process"]().get_View();cK=function(cL){return cL?m.txt("Logining to website..."):(m.button0("Login"))(function(){return g.login();});};cS=H["var'error"]().get_View();cT=function(cU){var cV,cW;if(cU.$==1){cW=cU.$0;cV=h.Div(e.ofArray([c.Style("color","red")]),e.ofArray([h.H20(e.ofArray([m.txt(cW)]))]));}else{cV=i.get_Empty();}return cV;};return h.Div0(e.ofArray([h.H10(e.ofArray([m.txt("Sign in")])),h.Table0(e.ofArray([h.TR0(e.ofArray([h.TD0(e.ofArray([m.txt("User name")])),h.TD0(e.ofArray([(m.input0())(H["var'user"]())]))])),h.TR0(e.ofArray([h.TD0(e.ofArray([m.txt("Password")])),h.TD0(e.ofArray([i.PasswordBox(cH,cI)]))]))])),h.P0(e.ofArray([m["Doc'Map"](cJ,cK),(m.button0("Cancel"))(function(){var cO,cP,cQ,cR;H["var'is'visible"]().set_Value(false);H["var'error"]().set_Value({$:0});cO=H.op_SpliceUntyped(H["key'user"]());cP=H["var'user"]();v.Set(cP,cO);cQ=H.op_SpliceUntyped(H["key'pass"]());cR=H["var'pass"]();return v.Set(cR,cQ);})])),m["Doc'Map"](cS,cT)]));}),"is'logged'in":$.Field(function(){return function(cX){return function(cY){return m["doc'on'off"](g["var'is'logged'in"](),cX,cY);};};}),login:function(){var cZ;cZ=t.Delay(function(){var c1;H["var'is'loginign'process"]().set_Value(true);c1=A.Async("WsNote2:6",[H["var'user"]().get_Value(),H["var'pass"]().get_Value()]);return t.Bind(c1,function(c2){var c3,c4,c5;H["var'is'loginign'process"]().set_Value(false);if(c2){H["var'is'visible"]().set_Value(false);H.op_LessEqualsEquals(H["key'user"](),H["var'user"]().get_Value());H.op_LessEqualsEquals(H["key'pass"](),H["var'pass"]().get_Value());g["var'is'logged'in"]().set_Value(true);H["var'error"]().set_Value({$:0});c4="Successfull login, username: "+H["var'user"]().get_Value();I?I.log(c4):undefined;c3=t.Return(null);}else{H["var'error"]().set_Value({$:1,$0:"Username or password incorrect"});c5="Error login, username: "+H["var'user"]().get_Value();I?I.log(c5):undefined;c3=t.Return(null);}return c3;});});return t.Start(cZ,{$:0});},"on'visible":$.Field(function(){return function(c6){return function(c7){return m["doc'on'off"](H["var'is'visible"](),c6,c7);};};}),"private members":{"button'login":$.Field(function(){var c8,c9;c8=e.ofArray([c.Class("btnlogin")]);c9=function(){return H["go'to'logining"]();};return i.Button("",c8,c9);}),"button'logout":$.Field(function(){var c$,da;c$=e.ofArray([c.Class("btnlogout")]);da=function(){var dc;dc=t.Delay(function(){return t.Bind(A.Async("WsNote2:7",[]),function(){g["var'is'logged'in"]().set_Value(false);return t.Return(null);});});return t.Start(dc,{$:0});};return i.Button("",c$,da);}),"go'to'logining":function(){return H["var'is'visible"]().set_Value(true);},key:$.Field(function(){return"4B929568-625C-4CD0-BED4-8EACC78D21E6-blog-";}),"key'pass":$.Field(function(){return H.key()+"pass";}),"key'user":$.Field(function(){return H.key()+"user";}),localStorage:function(){return J.localStorage;},op_LessEqualsEquals:function(df,dg){var dh,di,dj,dm,dn;try{dh=H.localStorage().setItem(df,dg);}catch(di){dj=function(dk){var dl;dl="localStorage : "+K.prettyPrint(dk);return I?I.log(dl):undefined;};dm=H.localStorage();dj(dm);dn=function(_do){var dp;dp="localStorage.SetItem : "+K.prettyPrint(_do);return I?I.log(dp):undefined;};dh=dn(di);}return dh;},op_SpliceUntyped:function(dq){var dr,ds,dt,dw,dx;try{dr=H.localStorage().getItem(dq);}catch(ds){dt=function(du){var dv;dv="localStorage : "+K.prettyPrint(du);return I?I.log(dv):undefined;};dw=H.localStorage();dt(dw);dx=function(dy){var dz;dz="localStorage.GetItem : "+K.prettyPrint(dy);return I?I.log(dz):undefined;};dx(ds);dr="";}return dr;},page:function(dA){var dB,dH,dJ,dK;dB=function(dC){return dC.$==0?t.Delay(function(){var dE;dE=v.Create(true);g["var'is'logged'in"]=function(){return dE;};return t.Return(null);}):t.Delay(function(){var dG;dG=v.Create(true);g["var'is'logged'in"]=function(){return dG;};return t.Return(null);});};dH=function(){return i.get_Empty();};dJ=j.MapAsync(dB,dA);dK=j.Map(dH,dJ);return i.EmbedView(dK);},"var'error":$.Field(function(){return v.Create({$:0});}),"var'is'loginign'process":$.Field(function(){return v.Create(false);}),"var'is'visible":$.Field(function(){return v.Create(false);}),"var'pass":$.Field(function(){var dL;dL=H.op_SpliceUntyped(H["key'pass"]());return v.Create(dL);}),"var'user":$.Field(function(){var dM;dM=H.op_SpliceUntyped(H["key'user"]());return v.Create(dM);})},protect:function(dN){return((g["is'logged'in"]())(dN))(i.get_Empty());},"set'logged'in":$.Field(function(){var dO;dO=g["var'is'logged'in"]();return function(dP){return v.Set(dO,dP);};}),"var'is'logged'in":$.Field(function(){return v.Create(false);})},NewPostUI:{button:$.Field(function(){return(m.button0("Create story"))(function(){return L["var'is'creating"]().set_Value(true);});}),doc:function(dR){var dS,dT;dS=e.ofArray([c.Style("width","100%")]);dT=L["var'title"]();return h.Div0(e.ofArray([h.H10(e.ofArray([m.txt("New Story")])),h.P0(e.ofArray([m.txt("Story title"),i.Input(dS,dT)])),h.P0(e.ofArray([m.txt("Story content"),m["doc'edit'content'input'area"](L["var'content"]())])),h.P0(e.ofArray([(m.button0("Create"))(function(){u["add'post"](dR,L["var'title"]().get_Value(),L["var'content"]().get_Value());return L.reset();}),(m.button0("Cancel"))(function(){return L.reset();})]))]));},on:$.Field(function(){return function(dW){return function(dX){return m["doc'on'off"](L["var'is'creating"](),dW,dX);};};}),"private members":{reset:function(){L["var'title"]().set_Value("");L["var'content"]().set_Value("");return L["var'is'creating"]().set_Value(false);},"var'content":$.Field(function(){return v.Create("");}),"var'is'creating":$.Field(function(){return v.Create(false);}),"var'title":$.Field(function(){return v.Create("");})}},PostUI:{doc:function(dY,dZ){var d0,d1,d2;d0="post-"+$$.String(dZ.Id)+"-article";d1=e.ofArray([c.Style("width","100%")]);d2=dZ.EditedTitle;return h.Div(e.ofArray([c.Class("panel panel-primary"),c.Create("id",d0)]),e.ofArray([M["doc'header"](dY,dZ),M["on'edit"](dZ,h.Div0(e.ofArray([h.P0(e.ofArray([m.txt("Title"),i.Input(d1,d2)])),h.P0(e.ofArray([m.txt("Content"),m["doc'edit'content'input'area"](dZ.EditedContent)]))])),M["doc'static'content"](dZ))]));},"private members":{"doc'crud":function(d3,d4){var d7;d7=h.Span0(e.ofArray([(m.button0("Delete"))(function(){return u["delete'post"](d3,d4);}),(m.button0("Change"))(function(){return d4.IsEditMode.set_Value(true);})]));return M["on'edit"](d4,h.Span0(e.ofArray([(m.button0("Apply"))(function(){return u["update'post"](d4);}),(m.button0("Cancel"))(function(){return d4.IsEditMode.set_Value(false);})])),g.protect(d7));},"doc'date":function(d_){return h.Div(e.ofArray([c.Class("post-date-block")]),e.ofArray([m.txt("Created:"),m.txt(d_.CreateDate),m.txt("Changed:"),i.TextView(d_.EditDate.get_View())]));},"doc'header":function(d$,ea){return h.Div(e.ofArray([c.Class("panel-heading")]),e.ofArray([i.TextView(ea.Title.get_View())]));},"doc'static'content":function(eb){var ec,ed;ec=eb.Content.get_View();ed=function(ee){var ef,eg,eh;ef=N("<div class=\"panel-body\">"+ee+"</div>").get(0);try{eg=i.Static(ef);}catch(eh){eg=m.txt(ee);}return eg;};return m["Doc'Map"](ec,ed);},"on'edit":function(ei,ej,ek){var el,em;el=ei.IsEditMode.get_View();em=function(en){return en?ej:ek;};return m["Doc'Map"](el,em);}}},UINextUtils:{"Doc'Map":function(eo,ep){var eq;eq=j.Map(ep,eo);return i.EmbedView(eq);},addViewListener:function(er,es,et){var eu,ew,ex;eu=function(ev){es(ev);return i.get_Empty();};ew=j.Map(eu,er);ex=i.EmbedView(ew);return i.Append(et,ex);},button0:function(ey){var ez;ez=$.New(s,{$:0});return function(eA){return i.Button(ey,ez,eA);};},"doc'edit'content'input'area":function(eB){var eC;eC=e.ofArray([c.Class("edit-post-input-area")]);return i.InputArea(eC,eB);},"doc'on'off":function(eD,eE,eF){var eG,eH;eG=j.FromVar(eD);eH=function(eI){return eI?eE:eF;};return m["Doc'Map"](eG,eH);},input0:$.Field(function(){var eJ;eJ=$.New(s,{$:0});return function(eK){return i.Input(eJ,eK);};}),op_LessMultiplyGreater:function(eL,eM){return O.Apply(eL,eM);},txt:function(eN){return i.TextNode(eN);},"var'str'to'int":function(eO){var eP;eP=function(eQ){var eR,eS,eT;eR=G["|Str'Int|_|"](eQ);if(eR.$==1){eT=eR.$0;eS=eT;}else{eS=eO;}return eS;};return v.Create(eP);}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.Attr);d=$.Safe($$.WebSharper.Seq);e=$.Safe($$.WebSharper.List);f=$.Safe($$.WsNote);g=$.Safe(f.LoginUI);h=$.Safe(b.Html);i=$.Safe(b.Doc);j=$.Safe(b.View);k=$.Safe(f.BlogUI);l=$.Safe(k["web application client side core"]);m=$.Safe(f.UINextUtils);n=$.Safe(f.NewPostUI);o=$.Safe(f.PostUI);p=$.Safe(b.ListModel1);q=$.Safe($$.WebSharper.Operators);r=$.Safe($$.String);s=$.Safe(e.T);t=$.Safe($$.WebSharper.Concurrency);u=$.Safe(f.ClientBlogData);v=$.Safe(b.Var);w=$.Safe(u["\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438 \u043d\u0430 \u0430\u0441\u043d\u043e\u0432\u0435 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439"]);x=$.Safe($$.WebSharper.Control);y=$.Safe(x.MailboxProcessor);z=$.Safe($$.WebSharper.Remoting);A=$.Safe(z.AjaxRemotingProvider);B=$.Safe($$.WebSharper.Collections);C=$.Safe(B.ResizeArray);D=$.Safe(C.ResizeArrayProxy);E=$.Safe(b.ListModel);F=$.Safe($$.Number);G=$.Safe(f.ClientUtils);H=$.Safe(g["private members"]);I=$.Safe($$.console);J=$.Safe($$.window);K=$.Safe($$.WebSharper.PrintfHelpers);L=$.Safe(n["private members"]);M=$.Safe(o["private members"]);N=$.Safe($$.jQuery);return O=$.Safe(b.View1);});$.OnLoad(function(){m.input0();L["var'title"]();L["var'is'creating"]();L["var'content"]();n.on();n.button();g["var'is'logged'in"]();g["set'logged'in"]();H["var'user"]();H["var'pass"]();H["var'is'visible"]();H["var'is'loginign'process"]();H["var'error"]();H["key'user"]();H["key'pass"]();H.key();H["button'logout"]();H["button'login"]();g["on'visible"]();g["is'logged'in"]();g["doc'logining"]();g.button();w.crud();l["var'posts'count"]();l["var'page'number"]();l["var'is'settings'visible"]();l["var'context"]();l["v'blog"]();l["doc'settings"]();return;});}());
